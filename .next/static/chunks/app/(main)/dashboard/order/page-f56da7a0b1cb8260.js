(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5539],{44996:(e,s,l)=>{Promise.resolve().then(l.bind(l,17599))},17599:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>S});var r=l(51047),n=l(76847),a=l(15343),t=l(18062),i=l(39077),d=l(41466),c=l(51500),o=l(49885),h=l(30872),x=l(5608),j=l(84668),u=l(92784),m=l(39329),p=l(75688),v=l(28509),N=l(66368),f=l(35672);let g=(0,f.createServerReference)("4009d142b287bbed0fc47d4fd547c507678649c267",f.callServer,void 0,f.findSourceMapURL,"getAllOrders");var b=l(63904);let y=e=>(null==e?void 0:e.results)&&Array.isArray(e.results)?e.results.map(e=>({id:e.id,first_name:e.first_name,last_name:e.last_name,email:e.email,orderPrice:e.orderPrice,orderItems:e.orderItems,userId:e.userId,street_address:e.street_address,status:e.status,vat:e.vat,total:e.total,company_name:null,apartment:null,town:e.town,phone_number:e.phone_number,createdAt:e.createdAt,updatedAt:e.updatedAt})):[],A=()=>{var e,s,l;let[a,t]=(0,n.useState)(""),[i,d]=(0,n.useState)(1),[f,A]=(0,n.useState)(10),[S,C]=(0,n.useState)({key:"createdAt",direction:"desc"}),[w,_]=(0,n.useState)(null),[k,I]=(0,n.useState)(!1),[L,F]=(0,n.useState)(""),{data:H,isLoading:O,isError:K}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(0,b.I)({queryKey:["orders",e,s],queryFn:()=>g({page:e,limit:s}),staleTime:0,retry:2})}(),M=y(null==H?void 0:H.data),P=(0,n.useMemo)(()=>{let e=M.filter(e=>{var s;let l=a.toLowerCase();return e.first_name.toLowerCase().includes(l)||e.last_name.toLowerCase().includes(l)||e.email.toLowerCase().includes(l)||(null!==(s=e.company_name)&&void 0!==s?s:"").toLowerCase().includes(l)});return e.sort((e,s)=>{let{key:l,direction:r}=S,n=e[l],a=s[l];return n<a?"asc"===r?-1:1:n>a?"asc"===r?1:-1:0}),e},[M,a,S]);P.length;let E=(0,n.useMemo)(()=>P.slice((i-1)*f,i*f),[P,i,f]),q=e=>{d(1),C(s=>{let l=s.key===e&&"asc"===s.direction?"desc":"asc";return{key:e,direction:l}})},D=e=>S.key!==e?null:"asc"===S.direction?(0,r.jsx)(m.A,{className:"ml-1 h-4 w-4 inline"}):(0,r.jsx)(p.A,{className:"ml-1 h-4 w-4 inline"});return O?(0,r.jsx)("div",{className:"flex justify-center p-6",children:"Loading orders..."}):K?(0,r.jsx)("div",{className:"flex justify-center p-6 text-red-500",children:"Error loading orders"}):(0,r.jsxs)("div",{className:"container mx-auto py-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Orders"}),(0,r.jsx)("div",{className:"flex gap-4",children:(0,r.jsx)(j.p,{placeholder:"Search orders...",value:a,onChange:e=>t(e.target.value),className:"w-64"})})]}),(0,r.jsx)("div",{className:"border rounded-md",children:(0,r.jsxs)(c.XI,{children:[(0,r.jsx)(c.A0,{children:(0,r.jsxs)(c.Hj,{children:[(0,r.jsxs)(c.nd,{className:"cursor-pointer",onClick:()=>q("id"),children:["ID ",D("id")]}),(0,r.jsxs)(c.nd,{className:"cursor-pointer",onClick:()=>q("first_name"),children:["First Name ",D("first_name")]}),(0,r.jsxs)(c.nd,{className:"cursor-pointer",onClick:()=>q("last_name"),children:["Last Name ",D("last_name")]}),(0,r.jsx)(c.nd,{children:"Email"}),(0,r.jsxs)(c.nd,{className:"cursor-pointer text-right",onClick:()=>q("total"),children:["Total ",D("total")]}),(0,r.jsxs)(c.nd,{className:"cursor-pointer",onClick:()=>q("status"),children:["Status ",D("status")]}),(0,r.jsxs)(c.nd,{className:"cursor-pointer",onClick:()=>q("createdAt"),children:["Created At ",D("createdAt")]}),(0,r.jsx)(c.nd,{className:"w-12"})]})}),(0,r.jsx)(c.BF,{children:E.length>0?E.map(e=>(0,r.jsxs)(c.Hj,{children:[(0,r.jsx)(c.nA,{children:e.id}),(0,r.jsx)(c.nA,{children:e.first_name}),(0,r.jsx)(c.nA,{children:e.last_name}),(0,r.jsx)(c.nA,{children:e.email}),(0,r.jsxs)(c.nA,{className:"text-right",children:["KSH ",(e.total/100).toFixed(2)]}),(0,r.jsx)(c.nA,{children:e.status}),(0,r.jsx)(c.nA,{children:new Date(e.createdAt).toLocaleDateString()}),(0,r.jsx)(c.nA,{children:(0,r.jsxs)(o.rI,{children:[(0,r.jsx)(o.ty,{asChild:!0,children:(0,r.jsx)(u.$,{variant:"ghost",size:"icon",children:(0,r.jsx)(v.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(o.SQ,{align:"end",children:[(0,r.jsx)(o.lp,{children:"Actions"}),(0,r.jsx)(o._2,{onSelect:()=>{_(e),I(!0)},children:"View Order"})]})]})})]},e.id)):(0,r.jsx)(c.Hj,{children:(0,r.jsx)(c.nA,{colSpan:8,className:"text-center py-6",children:"No orders found."})})})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(x.l6,{value:f.toString(),onValueChange:e=>{A(Number(e)),d(1)},children:[(0,r.jsx)(x.bq,{className:"w-16",children:(0,r.jsx)(x.yv,{placeholder:f})}),(0,r.jsxs)(x.gC,{children:[(0,r.jsx)(x.eb,{value:"5",children:"5"}),(0,r.jsx)(x.eb,{value:"10",children:"10"}),(0,r.jsx)(x.eb,{value:"25",children:"25"}),(0,r.jsx)(x.eb,{value:"50",children:"50"})]})]}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"per page"})]}),(0,r.jsx)(h.dK,{children:(0,r.jsx)(h.Iu,{children:(0,r.jsx)(h.cU,{children:(0,r.jsx)(h.Eb,{onClick:()=>d(e=>Math.max(e-1,1)),className:1===i?"pointer-events-none opacity-50":"cursor-pointer"})})})})]}),(0,r.jsx)(N.lG,{open:k,onOpenChange:I,children:(0,r.jsxs)(N.Cf,{className:"max-w-lg max-h-[70dvh]",children:[(0,r.jsxs)(N.c7,{children:[(0,r.jsxs)(N.L3,{children:["Order #",null==w?void 0:w.id]}),(0,r.jsx)(N.rr,{children:"Details and actions for this order"})]}),(0,r.jsxs)("div",{className:"space-y-4 p-1 h-[28rem] overflow-y-auto",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Customer"}),(0,r.jsxs)("p",{children:[null==w?void 0:w.first_name," ",null==w?void 0:w.last_name]}),(0,r.jsx)("p",{children:null==w?void 0:w.email})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Shipping Address"}),(0,r.jsxs)("p",{children:[null==w?void 0:w.street_address,", ",null==w?void 0:w.apartment]}),(0,r.jsx)("p",{children:null==w?void 0:w.town}),(0,r.jsx)("p",{children:null==w?void 0:w.phone_number})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Items"}),(0,r.jsx)("ul",{className:"space-y-2",children:null==w?void 0:w.orderItems.map((e,s)=>(0,r.jsxs)("li",{className:"border p-2 rounded",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Product:"})," ",e.productModel.name]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Qty:"})," ",e.quantity]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Price:"})," KSH ",(e.productModel.price/100).toFixed(2)]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Total:"})," KSH ",(e.productModel.price*e.quantity/100).toFixed(2)]})]},s))})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Subtotal:"})," KSH ",((null!==(e=null==w?void 0:w.orderPrice)&&void 0!==e?e:0)/100).toFixed(2)]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"VAT:"})," KSH ",((null!==(s=null==w?void 0:w.vat)&&void 0!==s?s:0)/100).toFixed(2)]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Total:"})," KSH ",((null!==(l=null==w?void 0:w.total)&&void 0!==l?l:0)/100).toFixed(2)]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-semibold",children:"Status"}),(0,r.jsxs)(x.l6,{value:L,onValueChange:e=>F(e),children:[(0,r.jsx)(x.bq,{className:"w-48",children:(0,r.jsx)(x.yv,{placeholder:"Select status"})}),(0,r.jsxs)(x.gC,{children:[(0,r.jsx)(x.eb,{value:"Awaiting Shipment",children:"Awaiting Shipment"}),(0,r.jsx)(x.eb,{value:"Awaiting Payment",children:"Awaiting Payment"}),(0,r.jsx)(x.eb,{value:"Completed",children:"Completed"}),(0,r.jsx)(x.eb,{value:"Cancelled",children:"Cancelled"})]})]})]}),(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)(u.$,{variant:"default",size:"sm",onClick:()=>{I(!1)},children:"Save Changes"})})]})]})})]})},S=e=>{let{data:s,isLoading:l,error:c}=(0,d.Q)(),[o,h]=(0,n.useState)(!1);return l?(0,r.jsx)("p",{children:"Loading orders..."}):c?(0,r.jsx)("p",{children:"Error fetching orders"}):(0,r.jsx)(a.A,{scrollable:!1,children:(0,r.jsxs)("div",{className:"flex flex-1 flex-col space-y-4",children:[(0,r.jsx)("div",{className:"flex items-start justify-between",children:(0,r.jsx)(t.D,{title:"Orders",description:"Manage Orders "})}),(0,r.jsx)(i.Separator,{}),(0,r.jsx)(A,{})]})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[9632,6796,7584,6629,6706,3904,482,2657,6368,5506,5721,9059,7358],()=>s(44996)),_N_E=e.O()}]);